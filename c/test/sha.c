#include <assert.h>
#include <stdio.h>
#include "../test.h"
#include "../sha.h"

static void check_hash(char *message, char *goal) {
	buffer message_buffer = buffer_create_from_str(message),
		goal_buffer = buffer_create_from_hex(goal),
		digest = buffer_calloc(32);
	
	sha hash = sha_init();
	sha_update(&hash, message_buffer);
	sha_end(&hash, &digest);
	
	assert(buffer_is_equal(digest, goal_buffer));
	
	buffer_free(&message_buffer);
	buffer_free(&goal_buffer);
	buffer_free(&digest);
}

static char *messages[] = {
	"",
	"d",
	"vz",
	"2cz",
	"&5q(",
	"ixflb",
	"r$),k+",
	"eru$s8r",
	",87;e$=k",
	"5b$yp*rfk",
	"$#!2i!+y3;",
	"+x0z05v$d+e",
	"g14]cv!suj8t",
	"s]k9_-vgq@bqh",
	"#ry&_fb#q4v(d.",
	"k8ipqpc%m286+,6",
	"#m*hzhp+r%$blf]9",
	"_=xr&.1a$%)g6wu5.",
	"7rz;]$8hr[iu+t_%*k",
	"-1$4ddqo9au9k3f[03g",
	"x6t-&)v3g7qb![cb_=.2",
	"d*-z&fr5g[fn;072]-=8a",
	"4$0w1y5-e&55c3qb)x+b]n",
	"o73z+sx![h4$+$--p(vl&1j",
	"!z_ooth6n#s;n!2fv&44;d#8",
	".k4kc=zz=d@(2t2;$=r5m%n,$",
	")3cyse@doi37bbf2!ow[_,c[ud",
	".1z=b%3qd5j@om5#i4#jd=rbi0!",
	"ek+1pj]_qfz,zmvo@g74hqwre#x*",
	"z%s@nshy=2utd8h_251pf-*4ifx0a",
	"ym$6d$!;zt[a21d!l2p*z(zgb;ii(e",
	"$&)klvgc#$uoim*+7;9qt]q+*;.;i7k",
	"g_@4-0e3-7im8u+k*uur.jk0jrd9lo[#",
	"ef7k0_5+v*f@77zqns.r1v4%3]er_,=u@",
	"y+jys&h+$4*ez9!*4$zfz5+np&qg4,bk*.",
	");ix*3gn-51+[5agylwu.=7__z.6b=w2mi1",
	"1w81=kavg5c7rjod;j%f*%.%!]74$41*h@ce",
	"w,q$y.*vhl%a6z*5yi*-n%4y]%c,!d46qzb0*",
	"xq@a1s2vu6yf*rau2(#gn-r1y4;d#j]pkx;x3p",
	"lvtak6yu%0b4o)c&*cb6#lb;cj!h#%w1([5[ho8",
	"38o5sb;n!=ge_409a#09m9*a]k_*q%woqq;lh9!r",
	"x,(x*!vrcwc4m*$@3=6$iw_gf%2])tn2@ro&z[l;8",
	"]mq0ljsufu1a-#v32_;@(9;n52]&6.&brlrchw#z(u",
	"=w!wq1vat1q6_=j*_9&-[8(9&,$n*erjn99_y%*6k;q",
	"i3h46pk_@9y)v%=gu7y&1ozic2qrn1!kfyw8-157mdkk",
	"d$jjz%=gl&1lv[.qft8p$1l,6b2hh5w(5&m,&w]=q[nk4",
	"-g_!bvz1d))1tc@2ez]flrge#z;vua7#wwh0v@uq!!!c5e",
	"t67_9,ws!**q2ri.0k!t3p.ujolji;eej*-(9.s!xa%)x7#",
	"5$4dkt+;g7+)+9)=v2qu8yu!&lx%n8sih@f#]k%7f+v@;,ap",
	"$y9#1_g%pjg,56=du2]-w]tp)xlgwxz2p-_v)c5le+[=cv1$j",
	"je[e+7i2;o[ptukoru-x8skr7h-nt9zzbrw[n4+iy=9rxm#,,b",
	"(xhb)#]zh0,5.bfi!j%k&]l0@gj-77i@nen;g(e)&,w_-!epqq#",
	"])&m!d).]l],*3,5rvarj_u6klf]5mof)9(f(__5*28&k]sp2rkf",
	"z@.uo@xil,tm];_0$+jj.@@+r=c_t0m&yjl,1jjqzs$[i,e;ly&=]",
	"5bu5#q81-dzbqu8.(=r,f3r)=,hsor_#5cm[3&*ol.*#71nj@)#%*x",
	"y3g;f+3_z[1c&usg&bygdd)j)+_wm3s0t,tdv1xced$9r%mcsy2e5lb",
	"(j!cm]p)eky#(7(q$_[c#8blj96!o[paelpg]jz5165n_ou-%g0$kv10",
	"5f%c56xhq7;h85wom@kv(w*_vx]7gnmbeme*07*+b$cs]qv[_81!(,a7e",
	"eu9ni&0,6!(zehqb0!e=()qn.1!7w0lrrn)n2wbmr7=n9i&]ib7hvr-&,d",
	",a1dwve4ef.=l42xz=783h5ie2dp#7,,$o$hn@x9wn;48j5y@(b%l(6kd(#",
	"o9kb9,w9zu#33[97q[zam6g6x%vi5lepb3o[lcg)rh5_)#[.4u0xtou8pm48",
	"[r8ug2+&s=ij2w&]k]#*z5vk1a)qigtgl-sa9r(p*-b58@;*ldma(kfr4[p.p",
	"jw=u-k8(;$6t!w]m2x6u##bosht2k6mm;9ga1f+9#x&m*%-8w=4((2kw74)6t%",
	"a).2fy)0wp;+s8modd03sp=9b.6&1ma7b0b(j172;2)6dp,9rf[[]=0s_=]xni]",
	"p9j(v68l#r4*ve!!lcvnc248![w[i(h97;_].c[+@j2(8kbs-3l4n_#kg6b+dj64",
	"v#3hj*=a$=am7kazsbop(r#[q[t..7+-l@wiz[[f=x0p-qlhzf;q5jy(qv2!@&!$3",
	"&h3g7]f=+tc#@i,!;4@nawg.!ix]&+g.s#szhy9dn0in.ezdbao]y=#!a2yto5.#(w",
	"ru%@p59k84]3$1fzz]7!j+4!@skov8&8=hk$ye[iaji(dlubk,d1x#n;xrszq,iki81",
	"@c0k-n98_$py=lp2)z9lmku665,a7&9j9w+_k)[!;=)fdx(6_x!8v&y11]e5.+,b%$q1",
	"5t_8h7,f=%dh#%]i(b-.)6cq9(mzlte&29q5(s09uu$@=ufe0ak5mr583l9+snt%3rit*",
	"hxf767spb6v#@q#g9t&++t.n7ezyyk1-s&)[s%hphuq@*8j1#jiii#z9er@v]f28,@;[j8",
	"z5.obisi78+)9h--i7n99w)127e9#t3a&.[%a8dkcm-_4oze]l6qp-4q7!tmage3h*p[-;0",
	"l,,.7k*qi*dmd.m%cc&_!v)fh05$99s(-!o.5cu!e$yp!naivu4;.!vuk2rg%0,!p;@q*2el",
	"@b=d]z,dpi8v(_x,1.pa6e%*k6*cgt4x[*;0c7,ys8h_.9$%61((lf6hq#e@sxnl3pv07p=,[",
	"2*$wamd5%4n_@w+@7x,1]vp[h7[%#$+9u0_aicu+)@[!l!7#!u)i-=vp.#601&zlm]ug,!9cex",
	"en;*#9s-(5qn_zu90ic!#mvesnjej3m2)!4%+vsg12&gffrun1wu*#u;x*7ir..n([l,a9d[qql",
	"$2rzw#=g#*(lqn8bw(&8b!6[eau6[x0133z#w;qpmxkqq&h2!h14&_n*+-r%=%od+06,w0--y(nm",
	"j%op]v[]$v_x,._t.@5j@$=u9xr(@55$cwc;o#$em77w=6-akcu._-j4pl42xkk!m5gph$7$d(#%$",
	"aca=5-#y09o&e*0%1+f;$er2n0zf%hl8%w]r%q_c4ep993d7a349kgialhj=,v8!w!stliua4=)lsa",
	"&g.k;96alt-]6=ll4c9!-5];3n=h.=(=@)a311%ls.=b)p9i&iszayiy7okf1d_q3cfwj4mcxu9&9jl",
	"3cccn2o$#&lzx+o)&@+my8-1v11pdj_u9n,)ayt[6lg*!-$m0i[q(tf1i#xairx[r,(qbk-vn7u2wsph",
	"4o@2@[=j.qdp1.tm72ks0k;%[=oc5f)*+427d+)*q#5*un5*]*7-vz9u]vc4*x_e;9kv795%o!y67l99[",
	"vblmn$q43h,;#%0cabh2]aqc1;;f6!acs]yi(eh2avoi$]oke,%#dwe%hi=m=z+@]w6i91uijo#t@g,@ll",
	"qf#y,8r3zr8+((7i6f((p01*@_%db@(im25g3_43d0,*y5ho+9m2.g2eyurizq+xh*!rsvv9kp-(=4;1#et",
	"@%o=9x0ls%q7ljj$$@4dym;;p0u]wvup&.3j=gp6jm8rka%x0j-1sf33+_e1g$@v,cd$aj@c&c-=@#jlfkv1",
	"l058shh2_8.%,l-u&#4xb2c;v@(6(!(k69gsh5!;r]zr]g=o!)v0]@9clz!gl;%zf[psy].ma7yumgyck1jz,",
	",q-#])ihh#b3u[$m]e-($,zetvdo6vumg8ztd04uvx,1n6&8(;5w=w1(3ot&3_x3s_up@ll;#1h*2r3j56+y#g",
	"5fevn--f4vy+cpm+h.te&-35.bky[x3c%w98u_z#$2t9v+%vh[@6z)k;.xz+ttocv$5-t3k#n+s)i1c[cc.@t9p",
	"q=a-k@[d$yiy@,54snt7h3hvzu!lvl%.esq40y;8&kl4nvg%(xe%)+4h(ugthz_.c#oyfn;b;.]bi3,xrsgk!u8n",
	"@5+gb,@94!47+&hxe#ktn8,q$+8j3=4&bwod8jh[tu)sykr[ao!i#2kjo)8y16_u2dga@$=3_fwk8q6jk78#1jfy+",
	"-1p@z4v)h!yifj2-e*0*d,+wxuo&r7r;=kw*q9@#fpc*vnnc.=iqf!mnq6@0)&zp;8n#gfra[nkyqi;(jio0$7zd6*",
	"+0+$])7&h[jmk13+eac5]1-]%5hff9!jx+yggw(d7_h-%@(ux#l&x4waps9dfc)g.vg5.95#._zf-*c%0,]9[kw9)9g",
	"lco3$5;43aw0f!$==[3f9113kig9d7(p.%+,r.82,,#cbe2q_@)6#ocuxr_)c61k*!0edh$!s72+qvt!n%@zn-a[0.(f",
	"vq6_&o,2hmkwfr8=-5i0e6)1n+mo91rz!vzpxu6z*3)+mxsl7fv!1p&kj+mh!#-j=t58h4v_s8g2o47xpwg@1ajceg,g+",
	"4g[81$48n(,xxkj$zq[%3yxeac*=](@,&mr1+6#1jo4qdh21(i(b#q$q6]s=*5h9$%5)k&f(k+p1r[jvp8*dt)il%uo1@%",
	"7[,)6c6#=re.,#r]ow1w$]e!#taxm+@8#-*uj08kwx$z74-@#!8g0)]4e#yku29l5-$v[o&$u;hs6)ddi-@pbnrj)!1=y,b",
	"v95(*zr);7.4j&k%7.l4xfsnojl4vg_3n7sdhy*84&on8a#w0+8j7,ze9lsbyte(y8q19l=@);,rr@#a4.)h7826-+&o-c5%",
	")#t@ywoe1;ws12ihy;o3n9!r742*#g;3*3r.h_ri[gbal,bge2uqo+h1.]sx--7u[;vqfceko;,.=n,%lt-61ajr9wq!&u)$_",
	"p6h,555!.f[!)yvh9li+8]c$qqam%9a364tsvqyu-p-0lz;2%m]v8!tl0zwyu.])zzdumold&hqtm0pt$#m4lki_r]@-ahc10j",
	"56b6+2j.)3x!;]q&lcx9gn.g0)@a5$n,.&$+b$,b8&9)t9]g(n%w,#[4p.=.-0tv098my#wy-9[rxg-eglx,dyg&x9zw*f*y.lq"
};

static char *hashes[] = {
	"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
	"18ac3e7343f016890c510e93f935261169d9e3f565436429830faf0934f4f8e4",
	"9685c81b76accc50694909aed78fa64a4cfa14a92c2f347785ef06b7840815a7",
	"332c141a768f4f5dc5eba387b665bd59d366a7a96f4eeac575b4e242cff611f1",
	"ab942df3725e288eb50484368293118a9cb4d9426ffde827d64fb019045cd0a8",
	"3d8da4ea1b2f1091d709c4b06117d5c5347bfeba65c4449c089f4babc052deaf",
	"97e58d4e8358249427d430b1f461525f197ff390eb4798eb76aaffac067a224e",
	"4043bdf3ab612ab3cf52f402ec0eb1c43ec219846e73327366ac20a019180094",
	"d1a38670cf16656192ef7404f366795aac51b75c81c215fa92eebf287e6c3ebb",
	"f7cb138b275e90adc7fc01c97ed01fc50058d5ce646334b58e91c9c524eef8eb",
	"b49d4a5c132b1a7a4ef81c31e340e2eb6b8a1063f6fd5e15b55e05aca310135c",
	"b1669dcbe85ca7f5de7a27d4ba721d16b377ee259e44fd7186efa619d0006bc8",
	"b1fb11600db8fb03c0a9a384a46640f54899edbd5190d9a36726db30deb28458",
	"079d97211d41943123c24e05c0d82002430de12cee4de54356be7d8fe0e0b2fc",
	"32334cdedc85a144133731da16f098686a943bb314494eb213629053c016787c",
	"ebfbbb173f3f6323724c143dd2073a5ea73def606530e825c99aef67d3ac4774",
	"fa74efc9d1d9ba15674f5dc09c29bf5240d3c11c62e1c6edd7a399a03581f593",
	"a99251dc995c49befc2c8c3fecd8cf64c15bb518e4704535d0792301b76f3f4c",
	"eb7c6462d60384522edd53a4106ecf8e8738e860170e21f434add2b23aaea1c1",
	"26d0059c29fc221390b3d8d56db8857579f76c3d00ac2bb32dae1292af624cf7",
	"1c68482da868b5551860ffe9e507b26652e93f1e476fa23a37b75f332c36d697",
	"b75b99214f7d3dba3ca023585e9af0404aa702dca878320ff05b5b474ecbe954",
	"8f248b391275b67c5b491a5bf7a99c2b692bd50193ae76b200cd04805f2fde63",
	"ea58485e126043437ff98f2f7a215d6a9f219e7f23b684dc21221c3f945214de",
	"fec43816e6f3afdba14e0e7858eb17f3505ae802af6c3ef1deeaab1b2d2fa646",
	"ade924a7cfbc6bb1ec5ddb39ad5b86417cb4416f56385ff80735a9e8b693f819",
	"17363809529d5721e50d52e25a1fa8c48ecfb8523263e5bd62f91693581d0a2c",
	"41a8ff7d42bedc7f6b520a95fd3b1f55a05b558a41015635bb1c8044b99caaff",
	"d94a37d60d8eeb9dc36b77c75396c7275c1ab7174185ca9d51aa248758f855ba",
	"0f11508e36359eac130bbfde63a4b6ebc34752ab1ed78a9f160e45f39c67b001",
	"db33d145c3c730a0c5f28dd20b8d125ae16e1e127bb8ac807c127f57dc0040cd",
	"cc83778bd4336b62e9cca2820f75aa45751970f4d125f51a487d92245af974ff",
	"b280561f786a329e75606e1dc5a1e1ac93c14b1cdbf7b28c6739522a57a98cb0",
	"41b9f5d38496ee33ddc99ac240ea5150774a03ee40080d103a270ac4845293a7",
	"084e3d51b22364e723ee1030a265756fc157e9dd0725ab5fc674334f97fb02d9",
	"6ba0c4b7131b047dba9dc332561758a7b4815498d8ca600268d6c8bf5bca89af",
	"71f12b01a2a9e96b4491baabe07c5e626383ec279b486d1a82c312ba90c6f961",
	"0159c42f4fa4a0cb42e16b6e293af6c2d416111a5deb34e6dcb5d4a7bf823494",
	"28ea6a0a10ff33d4d95a99dd5d149a60be2bc5bb771a28ed702ad3d500607a08",
	"f3707794bc279f6417cea800139590e3ae4f79e1c694f64bbc3b14671e2c7179",
	"24b0162cdbd2bcbe3d1570a982821ecfc8fb7c8c90411e7e83f18da22f69db9d",
	"c3f33a232acc6e4ebc8dea5cba021207a3a3399350459c2f4bff5288887a4e44",
	"b220554e3ae3c43ffd4b8363041c9ad59b87a9586aa83ea2e9e3ca7481f71de6",
	"cedd5cb96582b48f59ab4953425fe456536ad77d90d128838d2c5d23e25ba5ff",
	"46549a1e6d7130d33ecacb201dfcb3af2a1d377e124af22d70d2e7dffb01710a",
	"d763fdf7afb5c1964c8dba85c4a3cc0151036edafd7539cf6244259c5aebe0e5",
	"288b98adb753f13d6685b335056b83fde1dc6904dcfcd6f8c52a89514127b9f2",
	"f6fb6c40c49cafac74f7e371141013f04eff1a6250f68b2da15ed1595c6df524",
	"76d3e311a004f533e8b5042560b098abc87caf7ae06ba50c270ca9dd8986e602",
	"bbbddd49a8ad1c40ac42d9d56785599cce8fe72f02a18ed85368772c3154cab5",
	"00c05df12d5c0522c97f3f2504b42cbf02692f65a1b7ef3c325526e225e6d895",
	"12d556f9f7b9cf6cb576d723aad26f2f5b2c0bce203ddb7f2272ca3f5c778892",
	"555ff5ae602211614d058dad1c29dd4d8db60d2da4c83a60d91fa3a924100d7d",
	"5a41b84561bd5f313fb69bc3c3c565554d6adabdc308a8f386a5721492f045a0",
	"e93a436c784fc0241e82752c36821c3f5d317701dded69575cb1bc1aaa38b652",
	"26ae3d423dd731975ba2a9dbacc7dea1740e3eb296f12f5bac067da5f13562a7",
	"0dd04fb6e0157b7f5f89433bcef303c4b10353f18cc416b9e6d532fd99a7c72f",
	"2abf0e4fc0f3532c623b4110397831f3d6b1e39638a8d1518a558e29c23c04a5",
	"180a8cd543b8271b537cfe610c0566e20cd8729f979ea47ac4c66200eab8a0ec",
	"62c6bcd32f8df36e94f7701ddcd217aa5038f49fb50223d4443afd47e2186dc6",
	"d691247b93280ec3579101875623933b5fcb78ebe619905c0f9b92c0fbe4e169",
	"12cc5018dde62027ecee806116bace5212d6ed1023ae1c92153aa0faa3a82f1c",
	"701cf218a816690cc6dafdd27f91370eafa4c8d1d30415d7d8d09df1c67083f4",
	"9b5200f946adc38dcbd60a9f6b5ff665ef24ba324d630590e57eb3ae5e4ba41a",
	"f5e5293df4af27d6018a39d6f6dcc43df6ab0b299f5f15b12cfb77c0ed5b174b",
	"f660c7a4974b99384cd720f24f971e407d370177a6b612efdd8adda62d502c67",
	"6042b98324d221ed1f60648b7301c7e753244f951d8c712aee51dc76ba993200",
	"431900e45cbcffd3a11b925c6b03afab0d3822934f3f4cdba288ce57e6c83cd4",
	"e1ec15701ab714f10349c010a5615e5202b16b3da03b59288856d0cfbcddbb75",
	"61440b7a0a5695a25a6952bb2b0d9ebfe4e91b29116c3316405217d253380ff6",
	"96af5a735ae84caedab6205a1eddede235d963da5e7c57dad4642b486e676926",
	"f136e6826c6c8d97e35e20fdc5dff2bcae4b0b66ba5bf91ef634abc8729ddf22",
	"44d910502baf13edaf0e6ae760bac09754f199b53e0004c370253a98f74c1633",
	"db00b336b20059a849c6a474a8aa5c8e1a6406dd073deddafd47bb7a20e35b94",
	"2592a4b1571d113011df678314d284080acaf699af88524742158247d0e2b19c",
	"653198d8d1ed7cd7a0db5f02eb2f7393a5cb663a273206783789029e24a8ac8c",
	"f2250425982841327a1e4b15937046f9b0a794b8f4a66b5dcc885cfcfece77c1",
	"ec122588dec81056bf9f9381738a417a53de5e23a790083aaa995fed23da2423",
	"b89f5f79b8eb79d2ef5bc33f584cb51771f8a47155855a69eae80a93a467316f",
	"424d85e4de20cefee019532b9b36d41d470cac33cd64aff7dcf0189239b69ccc",
	"31c87f627dd3349e4a65febab4ad84c8f903a1641aa2784e774ac785aef420cc",
	"67e974ee03b3af7678af54af0710f16678ba428f75381b59d1cd99b5e8b15246",
	"bd0955ff9044dd0a480ebd1985fdd49622f9fafc37b0c3bf5823140253c0ef7d",
	"174a1be40ae6985783b73b49c6cacf35345d4f424089615b088dd69447043776",
	"428841eb119127b8637ea48a469fcc1e802372f3c5e3abcbad4d6b3296398c90",
	"2e72f48958680a82ed80343ac5e9b5500a73cba86169923f7039a1037c74df02",
	"6674b96e6ec6417acf333e31cca9f66db4bb20c15ba92b9e610139b94b49561c",
	"2cdda17eca454b21fef455909716b251a66ab2088b457b70e83c24a0c833605e",
	"9f75bba8ac2d1c0b48c9dab2ccb0a3847614e0d9fc2802a69f7e6b1958a0ec65",
	"34505f51ae332460f985e8aac004c86ed8f796a388dac9c245f7ceed3b9c8c03",
	"4c58e6f070cc1b393ceb2e190144b09af9136762f62228df996149ee78180a6a",
	"d673807382b7217c149a99525a351ec3a7d43b3ab1f33ab92035a226ef794707",
	"6f3430d25ea762055f4959e3bf4b0fe21231e207b1f9a3ad4246814f4c200a39",
	"268f1b2875aa0599e7ff11b6ffb0c814a57d1a869894a4cda4f35f3603ed4c23",
	"5e8409aa300acab83d213919170426747ec8e671c77ca41814821ea0795ffa8d",
	"e1ae7d338ba87d5e4d6bb60441e1977acbed86126f705fb7cac5fa1ba6453ae8",
	"cb39134e5baea1594a8c678ba3a7faff079a39611e4c77c0c9f81e4661517c60",
	"fe86e883ce2a7ea89f92b26bcaacb37cd202f8ce3e2544b43795af486fb193ce",
	"62ea21ac73c7498dd28e7c4a49f7d796ea7f66287eb7204702a0efba7f386981",
	"9e42ceb1efd6635fb127b083cae97a3f39ab8f4931c0019baedfa66bf13ee688"
};

void test_sha() {
	int n = sizeof(messages)/sizeof(messages[0]);
	for (int i=0; i<n; i++) {
		check_hash(messages[i], hashes[i]);
	}
	puts("sha: OK!");
}
